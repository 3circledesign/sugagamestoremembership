<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SUGA GAME STORE MEMBERSHIP • Game Covers</title>
  <link rel="icon" href="suga_logo.ico" type="image/x-icon">
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a2e;
      --text:#e6eefc;
      --muted:#96a2be;
      --accent:#7cc6ff;
      --ring:#2a3a5d;
      --header-h:120px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% -10%, #10213f 0, transparent 55%),
                  radial-gradient(1000px 500px at 100% 0%, #09203f 0, transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    header{
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      height: var(--header-h);
      backdrop-filter: blur(10px);
      background: rgba(11,18,32,.88);
      border-bottom:1px solid var(--ring);
    }
    .spacer{ height: var(--header-h); }

    .bar{
      max-width:1200px; margin:0 auto; padding:10px 16px;
      height: 100%;
      display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    h1{font-size:25px; margin:0; letter-spacing:.2px; font-weight:600; display:flex; align-items:center; gap:12px;}
    .logo{
      width:80px; height:80px; border-radius:10px; flex:0 0 auto;
      background: center/cover no-repeat url('suga_logo.ico');
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.4));
    }
    .pill{
      display:flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid var(--ring);
      border-radius:999px; background:rgba(255,255,255,.04)
    }
    .pill input{
      all:unset; width:280px; max-width:60vw; color:var(--text);
    }
    .pill input::placeholder{color:var(--muted)}

    .wrap{max-width:1200px; margin:20px auto; padding:0 16px 40px}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--ring);
      border-radius:14px; overflow:hidden;
      display:flex; flex-direction:column; min-height:280px;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,.35) }
    .thumb{
      aspect-ratio: 2/3; width:100%; background:#0a1427;
      display:block; object-fit:cover;
    }
    .meta{padding:10px 12px; display:flex; flex-direction:column; gap:6px}
    .name{font-size:14px; line-height:1.2}
    .sub{font-size:12px; color:var(--muted)}
    .row{display:flex; justify-content:space-between; align-items:center; gap:8px}
    .link{color:var(--accent); text-decoration:none}
    .link:hover{text-decoration:underline}

    .toast{
      position:fixed; bottom:18px; right:18px; background:#0e1b30; color:var(--text);
      border:1px solid var(--ring); padding:10px 12px; border-radius:12px; opacity:0; transform:translateY(8px);
      transition: all .18s ease; pointer-events:none; z-index: 1100;
    }
    .toast.show{opacity:1; transform:translateY(0)}

    /* ——— Floating Buy Button ——— */
    .fab-buy{
      position: fixed;
      right: 18px;
      bottom: 88px; /* keep clear of toast */
      z-index: 1200; /* above toast (1100) and header (1000) */
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      border-radius: 999px;
      text-decoration: none;
      color: #fff;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(135deg, #5c8dff 0%, #7b5cff 50%, #00d1ff 100%);
      box-shadow: 0 10px 30px rgba(0,0,0,.45), 0 0 0 6px rgba(124,198,255,.18);
      backdrop-filter: blur(6px);
      transform: translateY(0);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      animation: fabGlow 2.2s ease-in-out infinite;
      white-space: nowrap;
      max-width: 92vw;
    }
    .fab-buy:hover{ transform: translateY(-2px); box-shadow: 0 14px 38px rgba(0,0,0,.55), 0 0 0 8px rgba(124,198,255,.22); }
    .fab-buy:focus{ outline: none; box-shadow: 0 0 0 3px #0b1220, 0 0 0 6px rgba(124,198,255,.66); }
    .fab-buy svg{ flex:0 0 auto }
    .fab-text{ display:flex; flex-direction:column; line-height:1.05 }
    .fab-text strong{ font-size:14px; letter-spacing:.2px }
    .fab-text small{ font-size:11px; opacity:.9 }
    .fab-badge{
      position: absolute;
      top: -8px; right: -6px;
      background: #ff3b6b;
      color: #fff;
      font-size:10px; font-weight:700;
      padding:4px 6px; border-radius:999px;
      box-shadow: 0 6px 16px rgba(255,59,107,.45);
    }
    @keyframes fabGlow {
      0%,100% { filter: drop-shadow(0 0 0 rgba(124,198,255,0)); }
      50% { filter: drop-shadow(0 0 12px rgba(124,198,255,.55)); }
    }
    @media (max-width: 560px){
      .fab-text small{ display:none }
      .fab-buy{ padding:12px 14px; bottom: 82px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <h1><span class="logo" aria-hidden="true"></span> SUGA GAME STORE MEMBERSHIP</h1>
      <label class="pill" title="Search by name or AppID">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input id="q" type="search" placeholder="Search by name or AppID…" />
      </label>
    </div>
  </header>
  <div class="spacer" aria-hidden="true"></div>

  <main class="wrap">
    <div id="grid" class="grid"></div>
  </main>

  <div id="toast" class="toast"></div>

  <!-- Floating Buy Button -->
  <a
    class="fab-buy"
    href="https://shopee.com.my/3A-GAMES-UNLIMITED-STEAM-GAMES-MEMBERSHIP-(AUTO-STEAM-GUARD-FREE-ADD-TO-YOUR-OWN-LIBRARY)-i.1308249906.24183845744"
    target="_blank" rel="noopener nofollow"
    aria-label="Buy SUGA Game Store Membership on Shopee"
  >
    <span class="fab-badge">NEW</span>
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <circle cx="9" cy="21" r="1"></circle>
      <circle cx="20" cy="21" r="1"></circle>
      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
    </svg>
    <span class="fab-text">
      <strong>Get Membership</strong>
      <small>Auto Steam Guard • Add to Library</small>
    </span>
  </a>

  <script>
    const CDN = (appid) => `https://steamcdn-a.akamaihd.net/steam/apps/${appid}/library_600x900.jpg`;
    const GHRAW = (appid) => `https://raw.githubusercontent.com/barryhamsy/gamelist/main/${appid}.jpg`;
    const STORE = (appid) => `https://store.steampowered.com/app/${appid}/`;

    const state = { all: [], view: [] };
    const el = {
      grid: document.getElementById('grid'),
      q: document.getElementById('q'),
      toast: document.getElementById('toast')
    };

    function showToast(msg){
      const t = el.toast;
      t.textContent = msg;
      t.classList.add('show');
      clearTimeout(showToast._tid);
      showToast._tid = setTimeout(() => t.classList.remove('show'), 1400);
    }

    function placeholder(appid){
      return `https://placehold.co/400x600?text=${encodeURIComponent(appid)}`;
    }

    function setCoverWithFallback(img, appid){
      img.onerror = () => {
        img.onerror = () => {
          img.onerror = null;
          img.src = placeholder(appid);
        };
        img.src = GHRAW(appid);
      };
    }

    function render(list){
      el.grid.innerHTML = '';
      const frag = document.createDocumentFragment();
      for(const g of list){
        const card = document.createElement('article');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'thumb';
        img.loading = 'lazy';
        img.src = CDN(g.appid);
        img.alt = g.name;
        setCoverWithFallback(img, g.appid);
        card.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = g.name;
        const row = document.createElement('div');
        row.className = 'row';
        const sub = document.createElement('div');
        sub.className = 'sub';
        sub.textContent = `AppID: ${g.appid}`;
        const link = document.createElement('a');
        link.className = 'link';
        link.href = STORE(g.appid);
        link.target = '_blank';
        link.rel = 'noopener';
        link.textContent = 'Store →';
        row.appendChild(sub);
        row.appendChild(link);
        meta.appendChild(name);
        meta.appendChild(row);
        card.appendChild(meta);

        frag.appendChild(card);
      }
      el.grid.appendChild(frag);
    }

    function applyFilter(){
      const q = el.q.value.trim().toLowerCase();
      if(!q){
        state.view = state.all.slice();
      }else{
        state.view = state.all.filter(g => (g.name||'').toLowerCase().includes(q) || String(g.appid).includes(q));
      }
      render(state.view);
    }

    function safeParseJSON(raw) {
      try { return JSON.parse(raw); } catch(e) {}
      let s = raw.replace(/,\s*([\]}])/g, '$1').trim();
      try { return JSON.parse(s); } catch(e) {}
      if (!s.trim().startsWith('[') && !s.trim().startsWith('{')) s = '[' + s + ']';
      return JSON.parse(s);
    }

    function buildGithubRawFallbacks(){
      const host = location.hostname; // e.g., barryhamsy.github.io
      const user = host.replace('.github.io','');
      const parts = location.pathname.split('/').filter(Boolean);
      const repo = parts.length > 0 ? parts[0] : `${user}.github.io`;

      const branches = ['gh-pages','main','master'];
      const roots = ['', 'docs/'];
      const urls = [];
      for (const br of branches){
        for (const root of roots){
          urls.push(`https://raw.githubusercontent.com/${user}/${repo}/${br}/${root}games.json`);
        }
      }
      return urls;
    }

    async function fetchFirst(urls){
      for (const url of urls){
        try{
          const r = await fetch(url + (url.includes('?') ? '' : `?v=${Date.now()}`), { cache:'no-store' });
          if (r.ok) return await r.text();
        }catch(e){}
      }
      throw new Error('All sources failed');
    }

    async function loadGames(){
      try{
        const urls = [
          './games.json?v=' + Date.now(),
          ...buildGithubRawFallbacks()
        ];
        const raw = await fetchFirst(urls);
        const data = safeParseJSON(raw);
        const arr = Array.isArray(data) ? data : (Array.isArray(data.games) ? data.games : []);
        const seen = new Set();
        state.all = [];
        for(const x of arr){
          const appid = String(x.appid ?? '').trim();
          const name = String(x.name ?? '').trim();
          if(!appid || !name || seen.has(appid)) continue;
          seen.add(appid);
          state.all.push({appid, name});
        }
        showToast(`Loaded ${state.all.length} games`);
        applyFilter();
      }catch(err){
        showToast('Failed to load games.json');
        console.error(err);
      }
    }

    el.q.addEventListener('input', applyFilter);
    loadGames();
  </script>
</body>
</html>
