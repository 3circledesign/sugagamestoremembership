<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Accounts & Steam Guard</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="suga_logo.png">
  <meta name="theme-color" content="#1c1f2a">
</head>
<body>
  <header class="app-header">
    <!-- Brand / Logo -->
    <div class="brand">
      <img class="brand-logo" src="suga_logo.png" alt="Logo" onerror="this.style.display='none'">
      <div class="brand-title">Suga Game Store</div>
    </div>
  </header>

  <!-- License strip -->
  <div id="licStrip" class="license-strip hidden">
    <div id="licIcon" class="badge">Status</div>
    <div id="licText" class="lic-text"></div>
    <div class="license-actions">
      <button class="btn" id="btnActivate">Activate</button>
    </div>
  </div>

  <!-- Search -->
  <div class="searchbar" role="search">
    <input id="search" type="search" placeholder="Search by game name or AppID…" aria-label="Search games" />
    <button class="btn" id="clearBtn">Clear</button>
    <button class="btn tgl" id="btnOnline" aria-pressed="false" title="Show only games that support online">Online</button> <!-- NEW -->
    <button class="btn" id="btnRefresh" type="button" title="Re-download game list">Refresh</button>
  </div>

  <main class="layout">
    <section>
      <div id="grid" class="cardgrid"></div>
      <div id="emptyNote" class="ghost hidden">No games match your search.</div>
    </section>

    <!-- Right panel -->
    <aside id="panel" class="panel animate-in">
      <div id="heroWrap" class="hero empty">
        <img id="heroCover" alt="" />
        <div id="heroPlaceholder">Please select a game to show details</div>
      </div>

      <div id="gameTitle" class="detail-title">Select a game</div>
      <div id="gameSub" class="detail-sub"></div>

      <div class="row">
        <div class="label">Username</div>
        <input id="username" type="text" readonly />
        <button class="icon-btn" onclick="copyField('username')" aria-label="Copy username" title="Copy username">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
      </div>

      <!-- Password row removed from UI by request -->
      <!-- invisible stubs to keep older app.js from throwing null errors -->
      <div style="display:none">
        <input id="password" type="password" readonly />
        <button class="btn" id="btnShow" type="button">Show</button>
      </div>

      <!-- NEW: Login button -->
<div class="row row-actions">
  <button class="btn" id="btnLogin" type="button">Login to Steam</button>
  <button class="btn primary" id="btnFetch" type="button">Fetch Steam Guard Code</button>
</div>
<div class="row">
  <button class="btn" id="btnAddGame" type="button">Add game to my account</button>
  <button class="btn" id="btnRemoveGame" type="button">Remove game from my account</button>
</div>
      <div id="codeWrap" class="row">
        <div id="code" class="code">
          <div class="placeholders" aria-hidden="true">‒ ‒ ‒ ‒ ‒</div>
          <div class="digits" id="codeDigits"></div>
        </div>
        <button class="icon-btn" onclick="copyCode()" aria-label="Copy Steam Guard code" title="Copy code">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
      </div>

      <div id="status" class="ghost statusline"></div>
      <hr class="hr mt-8">

<h4 class="subhead">3rd Party Launcher Login</h4>

<div class="row">
  <div class="label">Platform</div>
  <input id="tpPlatform" type="text" readonly />
</div>

<div class="row">
  <div class="label">Username</div>
  <input id="tpUser" type="text" readonly />
  <button class="icon-btn" onclick="copyField('tpUser')" aria-label="Copy 3rd party username" title="Copy username">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>
  </button>
</div>

<div class="row">
  <div class="label">Password</div>
  <input id="tpPass" type="password" readonly />
  <button class="icon-btn"
          onclick="copyField('tpPass')"
          aria-label="Copy 3rd-party password"
          title="Copy password">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
         aria-hidden="true">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>
  </button>
</div>
<!-- Notes / Instructions -->
<div id="notesWrap" class="notes-wrap hidden">
  <div class="subhead">Notes / Instructions</div>
  <div id="notes" class="notes"></div>
</div>

    </aside>
  </main>

  <!-- Bottom-center pagination -->
  <nav class="pager-fixed" id="pager" aria-label="Pagination">
    <button class="pagebtn" id="prevBtn" aria-label="Previous page">«</button>
    <div class="pageinfo" id="pageInfo">Page 1 / 1</div>
    <button class="pagebtn" id="nextBtn" aria-label="Next page">»</button>
  </nav>

  <!-- Activation Modal -->
  <div id="actBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="actTitle">
    <div class="modal animate-in">
      <h3 id="actTitle">Activate License</h3>
      <div id="actExpired" class="warn hidden"></div>
      <div class="row">
        <div class="label">CD-Key</div>
        <input id="actKey" placeholder="xxxx-xxxx-xxxx-xxxx-xxxxxxxx" autocomplete="one-time-code">
      </div>
      <div class="row">
        <div class="label">Steam Account</div>
        <select id="actSteamSel" aria-label="Steam account"></select>
        <input id="actSteam" type="text" style="display:none">
      </div>
      <div class="note" id="steamPickHint">Pick the account to bind this license. The most recent account is selected by default.</div>
      <div class="note">First activation sets your plan duration (3M / 6M / 1Y). The key binds to this SteamID.</div>
      <div class="actions">
        <button class="btn" id="btnActCancel" type="button">Cancel</button>
        <button class="btn primary" id="btnActDo" type="button">Activate</button>
      </div>
      <div id="actMsg" class="ghost mt-6"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">Copied</div>

  <script defer src="app.js"></script>
  <script>
    function showToast() {
      const t = document.getElementById('toast');
      if (!t) return;
      t.classList.add('show');
      clearTimeout(showToast._tid);
      showToast._tid = setTimeout(() => t.classList.remove('show'), 1200);
    }
    function copyField(id) {
      const el = document.getElementById(id);
      if (!el) return;
      const val = el.value ?? '';
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(val).then(showToast);
      } else {
        el.select();
        document.execCommand('copy');
        showToast();
      }
    }
    function copyCode() {
      const box = $("code");
      const digitsEl = $("codeDigits");
      // Prefer data-code, then #codeDigits text, never read #code.innerText
      let code = (box && box.dataset && box.dataset.code) || "";
      if (!code && digitsEl) code = (digitsEl.textContent || "").replace(/\s+/g, "").trim();

      if (!code || !/^[A-Z0-9]{5}$/.test(code)) {
        // keep UX message consistent with your app
        setStatus && setStatus("No code to copy.");
        return;
    }

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(code).then(showToast);
      } else {
        const ta = document.createElement("textarea");
        ta.value = code;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast();
      }
    }
    function setCodeDigits(code) {
      const digitsEl = $("codeDigits");
      const box = $("code");
      if (!digitsEl || !box) return;

      const clean = (code || "").toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0, 5);
      digitsEl.textContent = clean.split("").join(" ");

      // hide/show placeholders so copy never grabs them
      const ph = box.querySelector(".placeholders");
      if (ph) ph.style.display = clean ? "none" : "";

      // Keep a data attribute for robust copy
      box.dataset.code = clean;
    }
  </script>
</body>
</html>
